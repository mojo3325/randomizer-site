# AGENTS.md — Правила для код-агента (Randomizer Site / Retro TV)

Документ задаёт правила, по которым агент вносит изменения в репозиторий. Цель: стабильный Next.js-проект с 3D-сценой (Retro TV) и интерактивным рандомайзером на экране ТВ.

---

## 1) Миссия проекта (что делаем)
- Веб-приложение: **3D-комната + старый CRT TV**.
- Камера: **статичная**, смотрит на ТВ (без OrbitControls).
- Экран ТВ: **интерактивный UI** (через `@react-three/drei` `Html transform`).
- Фича: **wheel/roulette randomizer**: список значений (без лимита), spin, честный выбор, результат, подсветка.

---

## 2) Негласные “нельзя” (non-negotiables)
- Нельзя ломать сборку. `npm run dev` должен стартовать без ошибок после изменений.
- Нельзя добавлять зависимости “на всякий случай”.
- Нельзя делать “магические фиксы” без причины (костыли, фоллбеки, лишние ветки).
- Нельзя менять публичные API компонентов без обновления всех мест использования.
- Нельзя снижать FPS заметно (особенно на ноутбуках/мобилках).
- Нельзя писать воду в ответах/коммитах/описаниях.

---

## 3) Технологический стек (фиксируем принципы, не версии)
- **Next.js (App Router)** + **TypeScript**.
- 3D: **three.js** через **@react-three/fiber**, helpers: **@react-three/drei**.
- Styling: **Tailwind CSS**.
- UI-анимации: **framer-motion** (только где реально нужно).
- Данные: local UI state + **localStorage** для списка значений.

---

## 4) Архитектура и структура проекта
Ожидаемая структура (ориентир):
- `app/` — страницы/лейауты (RSC по умолчанию; 3D и интерактив только в client components).
- `components/Scene/*` — сцена, комната, свет, TV модель.
- `components/Screen/*` — UI экрана и логика рулетки.
- `components/ui/*` — мелкие UI-компоненты (Button/Input).
- `lib/*` — утилиты.

Правило: **3D-часть не должна знать бизнес-логику рандомайзера**, кроме “встроить экран”.

---

## 5) Правила кодинга (качество)
### TypeScript
- Строгая типизация пропсов/стейта.
- Убирай `any` (разрешено только временно, максимум в 1 месте и с TODO).

### Чистота
- Компоненты держать компактными: если растёт, выноси части/хуки.
- DRY: повторяемые материалы/эффекты/утилиты выносить.
- Никаких “мертвых” импортов, логов, закомментированного мусора.

### UI/UX
- Кнопки/инпуты: нормальные disabled/error состояния.
- Фокус/клавиатура: tab работает, кнопки доступны.
- Сообщения об ошибках короткие и понятные.

---

## 6) 3D правила (важно)
### Камера
- Камера **фиксирована**. Никаких OrbitControls / drag-управления.
- Допускается лёгкий “дышащий” эффект (очень аккуратно), но по умолчанию камера стоит.

### Свет
- Минимум: ambient + key light + TV glow (point near screen).
- Тени включать только если это не убивает производительность; настраивать `shadow-mapSize` адекватно.

### Материалы и геометрия
- Геометрия простая, “low-poly believable”.
- Переиспользуй `useMemo` для геометрий/материалов.
- Не создавай новые `MeshStandardMaterial` на каждый рендер.

### Производительность
- `useFrame` только по делу. Никаких тяжёлых вычислений/рандома в каждом кадре.
- `dpr={[1,2]}` допустимо; не завышай.
- Избегай тяжёлого постпроцессинга без необходимости.

---

## 7) Экран ТВ (интерактив внутри 3D)
- Реализуем UI **на плоскости экрана** через `Html transform`.
- У UI есть “CRT слой”: scanlines + мягкий flicker (CSS), аккуратный glow.
- Клик должен попадать по UI без боли: правильный `pointerEvents`, `transform`, размеры попадания.
- На hover интерактива курсор меняется (`cursor: pointer`).

---

## 8) Рандомайзер (wheel) требования
- Можно добавлять **неограниченное** количество значений.
- CRUD списка: add/edit/remove + Clear.
- Spin:
  - запрещён при `< 2` элементах (показать ошибку).
  - на время спина UI блокируется от изменений списка.
  - честный выбор: `crypto.getRandomValues`.
  - итоговая анимация должна гарантированно “приземляться” на выигравший сектор.
- После спина:
  - показать результат крупно,
  - подсветить сегмент/плашку победителя,
  - опционально короткий конфетти/сияние (без тяжёлых либ).

---

## 9) Хранение данных
- Список значений сохраняется в `localStorage`.
- Загружается на mount (client side).
- При ошибке localStorage не падаем: просто работаем без persistence.

---

## 10) Проверки перед сдачей (обязательно)
Перед тем как считать задачу выполненной:
- `npm run dev` стартует без ошибок.
- Экран не “чёрный”, сцена видна.
- Камера статична.
- Экран кликается: ввод, add, spin работают.
- Спин честный и воспроизводимо заканчивается на результат.
- Нет warn/error в консоли (кроме редких three предупреждений, которые ты объясняешь).
- Нету “дерготни” UI и утечек интервалов/raf (всё чистится).

---

## 11) Как агент должен отвечать (стиль коммуникации)
- По умолчанию: **5–7 строк**, только суть.
- Если нужно изменить много файлов: сначала список файлов + что в них меняется (коротко), потом код.
- Никаких фантазий: если нет инфы, так и писать.
- Конкретика: файлы, функции, причины.

---